<!DOCTYPE html>
<body>
    <label for="playlists">Playlist:</label>
    <select id="playlists" name="playlists"></select>
    <script>
        document.addEventListener('dialog-opened', function() {
            nodecg.sendMessage('youtubeCommand', {
                command: 'dbQuery',
                callback_id: 'get_playlists',
                table: 'yt_playlists_registry'
            }).then(result => {
                var keys = Object.keys(result);
                keys.shift();
                for(var i = 0; i < keys.length; i++) {
                    var playlistName = keys[i].replace(/^ytPlaylist_/, '');
                    document.getElementById('playlists').innerHTML += "<option value=\"" + playlistName + "\">" + playlistName +"</option>";
                }
            }).catch(error => {
                console.error(error);
            });
        });
        document.addEventListener('dialog-confirmed', function() {
            let playlist = document.getElementById('playlists').value;
            console.log(playlist);
            if (playlist.length >0){
                nodecg.sendMessage('youtubeCommand', {
                    command: 'loadPlaylist',
                    playlist: playlist
                })
            }
            document.getElementById('playlists').value = null;
        })
    </script>
</body>